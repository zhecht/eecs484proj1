# eecs484proj1

CREATE TRIGGER insert_location_trigger
AFTER INSERT
	ON Location
	FOR EACH ROW
DECLARE
	rows_found NUMBER;
BEGIN
	IF :NEW.CHECK_USER IS NOT NULL THEN
		SELECT COUNT(*) INTO rows_found FROM UserLivesInLocation WHERE ROWNUM <= 1 AND USER_ID = :NEW.USER_ID;
		IF :NEW.CHECK_HOME IS NOT NULL THEN
			IF rows_found IS NOT NULL THEN
				UPDATE UserLivesInLocation SET HOMETOWN_LOCATION_ID = :NEW.LOCATION_ID WHERE USER_ID = :NEW.USER_ID;
			ELSE
				INSERT INTO UserLivesInLocation (USER_ID, HOMETOWN_LOCATION_ID) VALUES (:NEW.USER_ID, :NEW.LOCATION_ID);
			END IF;
		ELSE
			IF rows_found IS NOT NULL THEN				
				UPDATE UserLivesInLocation SET CURRENT_LOCATION_ID = :NEW.LOCATION_ID WHERE USER_ID = :NEW.USER_ID;
			ELSE
				INSERT INTO UserLivesInLocation (USER_ID, CURRENT_LOCATION_ID) VALUES (:NEW.USER_ID, :NEW.LOCATION_ID);
			END IF;
		END IF;
	ELSE
		INSERT INTO EventIsInLocation (EVENT_ID, LOCATION_ID) VALUES (:NEW.EVENT_ID, :NEW.LOCATION_ID);
	END IF;
	
END;